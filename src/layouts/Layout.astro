---
import { getLangFromUrl, useTranslations } from '../utils/i18n';
import { SEO } from 'astro-seo';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
}

const { title, description, image, type = 'website' } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const defaultDescription = lang === 'vi' 
  ? 'AI Master 4U - Nền tảng toàn diện kết nối bạn với kiến thức chuyên sâu và công cụ AI đỉnh cao'
  : 'AI Master 4U - Your ultimate platform connecting you to in-depth AI knowledge and cutting-edge tools';

const seoDescription = description || defaultDescription;
const seoImage = image || '/og-image.jpg';
---

<!DOCTYPE html>
<html lang={lang}>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta name="generator" content={Astro.generator} />
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- SEO -->
  <SEO
    title={title}
    description={seoDescription}
    openGraph={{
      basic: {
        title: title,
        type: type,
        image: seoImage,
        url: Astro.url.toString(),
      },
      optional: {
        description: seoDescription,
        siteName: 'AI Master 4U',
        locale: lang === 'vi' ? 'vi_VN' : 'en_US',
      },
    }}
    twitter={{
      creator: '@aimaster4u',
      site: '@aimaster4u',
      card: 'summary_large_image',
    }}
    extend={{
      link: [
        { rel: 'canonical', href: Astro.url.toString() },
        { rel: 'alternate', hreflang: 'vi', href: Astro.url.toString().replace('/en', '') },
        { rel: 'alternate', hreflang: 'en', href: Astro.url.toString().replace(/^(https?:\/\/[^\/]+)/, '$1/en') },
      ],
      meta: [
        { name: 'robots', content: 'index, follow' },
        { name: 'author', content: 'AI Master 4U' },
        { name: 'keywords', content: lang === 'vi' ? 'AI, trí tuệ nhân tạo, công cụ AI, blog AI, học máy' : 'AI, artificial intelligence, AI tools, AI blog, machine learning' },
      ],
    }}
  />
  
  <!-- Structured Data -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "AI Master 4U",
      "url": "https://aimaster4u.com",
      "description": seoDescription,
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://aimaster4u.com/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
  </script>
</head>
<body class="min-h-screen bg-white font-inter">
  <Header />
  <main>
    <slot />
  </main>
  <Footer />
  
  <!-- Global Scripts -->
  <script>
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Add loading states to external links
    document.querySelectorAll('a[href^="http"]').forEach(link => {
      link.addEventListener('click', function() {
        this.style.opacity = '0.7';
        this.style.pointerEvents = 'none';
        setTimeout(() => {
          this.style.opacity = '1';
          this.style.pointerEvents = 'auto';
        }, 2000);
      });
    });
  </script>
</body>
</html>